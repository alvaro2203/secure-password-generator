---
// Sticky Navigation Component
// Provides anchored navigation to different sections of the page
---

<nav
  class="fixed top-0 left-0 right-0 z-40 bg-white/80 dark:bg-gray-900/80 backdrop-blur-md border-b border-gray-200 dark:border-gray-700 transition-all duration-300"
  role="navigation"
  aria-label="Main navigation"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      <!-- Logo/Brand -->
      <div class="flex-shrink-0">
        <a
          href="#hero"
          class="text-xl font-bold text-gray-900 dark:text-white hover:text-primary-600 dark:hover:text-primary-400 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 rounded-md px-2 py-1"
          aria-label="Secure Password Generator - Go to top"
        >
          üîê SecureGen
        </a>
      </div>

      <!-- Desktop Navigation -->
      <div class="hidden md:block">
        <div class="ml-10 flex items-baseline space-x-4" role="menubar">
          <a
            href="#hero"
            class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-gray-100 dark:hover:bg-gray-800 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
            role="menuitem"
            aria-label="Go to hero section"
          >
            Home
          </a>
          <a
            href="#features"
            class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-gray-100 dark:hover:bg-gray-800 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
            role="menuitem"
            aria-label="Go to features section"
          >
            Features
          </a>
          <a
            href="#generator"
            class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-gray-100 dark:hover:bg-gray-800 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
            role="menuitem"
            aria-label="Go to password generator"
          >
            Generator
          </a>
          <a
            href="#how-it-works"
            class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-gray-100 dark:hover:bg-gray-800 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
            role="menuitem"
            aria-label="Go to how it works section"
          >
            How It Works
          </a>
          <a
            href="#faq"
            class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-gray-100 dark:hover:bg-gray-800 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
            role="menuitem"
            aria-label="Go to FAQ section"
          >
            FAQ
          </a>
        </div>
      </div>

      <!-- Right side: Theme toggle and mobile menu -->
      <div class="flex items-center space-x-2">
        <!-- Theme Toggle Button -->
        <button
          id="theme-toggle"
          class="p-2 rounded-md bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-gray-200 dark:hover:bg-gray-700 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
          aria-label="Toggle theme"
          title="Toggle theme"
        >
          <svg
            id="theme-icon"
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
            ></path>
          </svg>
        </button>

        <!-- Mobile menu button -->
        <button
          type="button"
          id="mobile-menu-button"
          class="md:hidden inline-flex items-center justify-center p-2 rounded-md text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500 transition-all duration-200"
          aria-controls="mobile-menu"
          aria-expanded="false"
          aria-label="Toggle navigation menu"
        >
          <svg
            id="menu-icon"
            class="block h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"
            ></path>
          </svg>
          <svg
            id="close-icon"
            class="hidden h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            ></path>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Navigation Menu -->
  <div
    id="mobile-menu"
    class="md:hidden hidden bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700"
    role="menu"
    aria-labelledby="mobile-menu-button"
  >
    <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
      <a
        href="#hero"
        class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-gray-100 dark:hover:bg-gray-800 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
        role="menuitem"
        aria-label="Go to hero section"
      >
        Home
      </a>
      <a
        href="#features"
        class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-gray-100 dark:hover:bg-gray-800 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
        role="menuitem"
        aria-label="Go to features section"
      >
        Features
      </a>
      <a
        href="#generator"
        class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-gray-100 dark:hover:bg-gray-800 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
        role="menuitem"
        aria-label="Go to password generator"
      >
        Generator
      </a>
      <a
        href="#how-it-works"
        class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-gray-100 dark:hover:bg-gray-800 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
        role="menuitem"
        aria-label="Go to how it works section"
      >
        How It Works
      </a>
      <a
        href="#faq"
        class="mobile-nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 hover:bg-gray-100 dark:hover:bg-gray-800 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
        role="menuitem"
        aria-label="Go to FAQ section"
      >
        FAQ
      </a>
    </div>
  </div>
</nav>

<script>
  import {
    initializeTheme,
    toggleTheme,
    getCurrentTheme,
    getThemeDisplayName,
  } from "../services/themeService";

  // Initialize theme on page load
  initializeTheme();

  // Mobile menu toggle functionality
  function initializeMobileMenu() {
    const mobileMenuButton = document.getElementById("mobile-menu-button");
    const mobileMenu = document.getElementById("mobile-menu");
    const menuIcon = document.getElementById("menu-icon");
    const closeIcon = document.getElementById("close-icon");

    if (!mobileMenuButton || !mobileMenu || !menuIcon || !closeIcon) return;

    let isOpen = false;

    function toggleMenu() {
      isOpen = !isOpen;
      
      if (isOpen) {
        mobileMenu.classList.remove("hidden");
        menuIcon.classList.add("hidden");
        closeIcon.classList.remove("hidden");
        mobileMenuButton.setAttribute("aria-expanded", "true");
      } else {
        mobileMenu.classList.add("hidden");
        menuIcon.classList.remove("hidden");
        closeIcon.classList.add("hidden");
        mobileMenuButton.setAttribute("aria-expanded", "false");
      }
    }

    // Toggle menu on button click
    mobileMenuButton.addEventListener("click", toggleMenu);

    // Close menu when clicking on navigation links
    const mobileNavLinks = document.querySelectorAll(".mobile-nav-link");
    mobileNavLinks.forEach(link => {
      link.addEventListener("click", () => {
        if (isOpen) {
          toggleMenu();
        }
      });
    });

    // Close menu on escape key
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && isOpen) {
        toggleMenu();
      }
    });
  }

  // Theme toggle functionality
  function initializeThemeToggle() {
    const themeToggle = document.getElementById("theme-toggle");
    const themeIcon = document.getElementById("theme-icon");

    // Update icon based on current theme
    function updateThemeIcon() {
      const theme = getCurrentTheme();
      const isDark =
        theme === "dark" ||
        (theme === "system" &&
          window.matchMedia("(prefers-color-scheme: dark)").matches);

      if (isDark) {
        // Moon icon for dark theme
        themeIcon?.setAttribute(
          "d",
          "M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
        );
      } else {
        // Sun icon for light theme
        themeIcon?.setAttribute(
          "d",
          "M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
        );
      }

      // Update tooltip
      const displayName = getThemeDisplayName(theme);
      themeToggle?.setAttribute(
        "title",
        `Current theme: ${displayName}. Click to cycle themes.`
      );
    }

    // Handle theme toggle
    themeToggle?.addEventListener("click", () => {
      const newTheme = toggleTheme();
      updateThemeIcon();

      // Add visual feedback
      themeToggle?.classList.add("animate-pulse");
      setTimeout(() => {
        themeToggle?.classList.remove("animate-pulse");
      }, 200);
    });

    // Update icon on page load
    updateThemeIcon();

    // Listen for system theme changes
    window
      .matchMedia("(prefers-color-scheme: dark)")
      .addEventListener("change", updateThemeIcon);
  }

  // Smooth scrolling for navigation links
  function initializeSmoothScrolling() {
    const navLinks = document.querySelectorAll(".nav-link, .mobile-nav-link");
    
    navLinks.forEach(link => {
      link.addEventListener("click", (e) => {
        e.preventDefault();
        const targetId = link.getAttribute("href");
        const targetElement = document.querySelector(targetId);
        
        if (targetElement) {
          const navbarHeight = 64; // Height of fixed navbar
          const targetPosition = targetElement.offsetTop - navbarHeight;
          
          window.scrollTo({
            top: targetPosition,
            behavior: "smooth"
          });
        }
      });
    });
  }

  // Active link highlighting
  function initializeActiveLinks() {
    const sections = document.querySelectorAll("section[id]");
    const navLinks = document.querySelectorAll(".nav-link, .mobile-nav-link");

    function updateActiveLink() {
      const scrollPosition = window.scrollY + 100; // Offset for navbar

      sections.forEach(section => {
        const sectionTop = section.offsetTop;
        const sectionHeight = section.offsetHeight;
        const sectionId = section.getAttribute("id");

        if (scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
          navLinks.forEach(link => {
            link.classList.remove("text-primary-600", "dark:text-primary-400");
            if (link.getAttribute("href") === `#${sectionId}`) {
              link.classList.add("text-primary-600", "dark:text-primary-400");
            }
          });
        }
      });
    }

    window.addEventListener("scroll", updateActiveLink);
    updateActiveLink(); // Initial call
  }

  // Initialize all functionality
  document.addEventListener("DOMContentLoaded", () => {
    initializeMobileMenu();
    initializeThemeToggle();
    initializeSmoothScrolling();
    initializeActiveLinks();
  });
</script>